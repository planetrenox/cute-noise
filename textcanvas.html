<script src="https://cdn.jsdelivr.net/npm/piercer-error"></script>
<body>
  <p class="txx">This is text in a p tag but our function should work with any text inside any tag with this class</p>
  <!-- ... more elements ... -->
</body>
<script type='module'>
  var applyN=function applyN1(canvas) {
    const ctx = canvas.getContext('2d');

    // Set background to transparent by not drawing it

    // Retrieve the image data
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imageData.data;

    // Apply a noise effect
    for (let i = 0; i < data.length; i += 4) {
      // Generate random noise
      const noise = Math.random() * 50;

      // Apply the noise
      data[i] -= noise;     // red
      data[i + 1] -= noise; // green
      data[i + 2] -= noise; // blue
      // Alpha channel (i + 3) is left unchanged
    }

    // Update the canvas with the modified pixels
    ctx.putImageData(imageData, 0, 0);
  }
</script>
<script type='module'>
  import {$, html} from 'https://cdn.jsdelivr.net/npm/cute-html/+esm';
  var textPixels = [];
  var edgePixels = [];
  
  var detect= function detect1(canvas) {
    const ctx = canvas.getContext('2d');
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imageData.data;

    // Your logic to detect text pixels and edge pixels
    for (let i = 0; i < data.length; i += 4) {
      if (data[i + 3] > 0 && data[i + 3] < 255) {
        edgePixels.push(i);
      } else if (data[i + 3] === 255) {
        textPixels.push(i);
        $('body').inject(html`${i + ' '}`);
      }
    }

    // Here you can call applyN or any other function to manipulate those pixels
  }
</script>
<script type='module'>
  function convertTextToCanvas(textElement) {
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');
    var style = window.getComputedStyle(textElement);
    var fontSize = style.getPropertyValue('font-size');
    var fontFamily = style.getPropertyValue('font-family');

    ctx.font = `${fontSize} ${fontFamily}`;
    canvas.width = textElement.offsetWidth;
    canvas.height = textElement.offsetHeight;

    ctx.textBaseline = 'top';
    ctx.fillStyle = style.getPropertyValue('color');
    ctx.fillText(textElement.textContent, 0, 0);

    // Now we have the text on the canvas, we can detect and store the text pixels
    detect(canvas);

    // Then apply the noise to those pixels
    applyN(canvas);

    return canvas;
  }

  function replaceTextWithCanvas() {
    var textElements = document.querySelectorAll('.txx');
    textElements.forEach(function(element) {
      var canvas = convertTextToCanvas(element);
      element.parentNode.replaceChild(canvas, element);
    });
  }
  replaceTextWithCanvas();
 // window.addEventListener('load', replaceTextWithCanvas);
</script>
